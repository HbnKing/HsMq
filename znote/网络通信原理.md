
| TCP/IP | TCP/IP | OSI | 内容 |
| :---: | :---: | :---: | :---: |
| 应用层 | 应用层 | 应用层 | HTTP/FTP/POP3 等等应用协议 |
|  |  | 表示层 |  |
|  |  | 会话层 |  |
| 传输层 | 传输层 | 传输层 | TCP协议 |
| 网络层 | 网络层 | 网络层 | IP协议 |
| 网络接口层 | 数据链路层 | 数据链路层 | 将0 1 信号进行组封装位数据包 |
|  | 物理层 | 物理层 | 基于电信号发送高低位信号 |



## 三次握手
客户端发起请求

|  | client |  | server |  |
| :---: | :---: | :---: | :---: | :---: |
| syn_send | SYN=1   seq = x | -> |  |  |
|  |  | <- | SYN = 1   ACK=1    seq=y ack= x+1 | syn_recv |
| 连接成功 | ACK=1  ack = y+1  | -> |  | 连接成功 |

## 数据传输
|  | 写 |  | 读 |  |
| :---: | :---: | :---: | :---: | :---: |
|  | seq=x+1 ack=y+1 | -> |  |  |
|  |  | <- | ack = x+2 |  |

## 四次挥手
任意一方发起

|  | client |  | server |  |
| :---: | :---: | :---: | :---: | :---: |
| fin_wait_1 | FIN=1 seq=u | -> |  |  |
| fin_wait_2 |  | <- | ACK=1 ack=u+1  seq=v | close_wait |
| time_walt |  | <- | FIN =1 ACK=1 seq =w ack=u+1 | last_ack |
| time_walt | ACK=1 seq=u+1 ack=w+1 | -> |  | close() |





1. 客户端发起中断请求，FIN 请求，seq为(前面传送过来的最后一个数据字节+1)，意味着客户端没有数据发送了
1. 此时返回一个ACK确认，表示收到了，但是服务端如果有数据需要发送，还是可以继续发送，客户端也需要接受。并且服务端进行等待关闭。客户端接口之后，进入终止等待2状态
1. 当服务端的数据发送完成之后，服务端 发送FIN 请求，服务端进入最后确认状态
1. 当客户端收到最后确认之后，发送确认消息，服务端收到后立即 进入CLOSE 状态。但是客户端此时还没有关闭，必须等待（2MSL）2倍最长报文寿命的时候，才能进入CLOSE状态 ，（可以设置不等待，直接关闭）




## IO是什么

1. 对于Unix来说，一切皆文件，Socket,管道，FIFO,终端，都是文件，操作这些文件，就是IO操作
1.  文件描述符（FD）,文件描述符标识 文件流，让操作系统可以找到需要操作的流。
## 用户空间/内核空间

1. 内核空间存放的是内核代码 和 数据
   1. 权限为0级
2. 用户空间存放的是用户代码 和 数据 
   1. 权限为3级



### 一般的网络操作为：

1. 等待数据到达网卡，然后将数据复制到内核缓冲区
1. 从内核缓冲区复制数据，然后拷贝到用户空间



## IO模型

- IO模型一般分为两个步骤，1 等待 2.数据复制
| IO模型 | 特点 | 优点 | 缺点 |
| --- | --- | --- | --- |
| 阻塞IO模型 | 在IO执行的两个阶段，都会被阻塞 | 1.阻塞进程不占用CPU
2.响应即时 | 1.需要为每一个请求分配一个线程，系统开销大，不适合大并发 |
| 非阻塞IO模型 | 第一阶段不阻塞，由阻塞变为不断的轮询
第二阶段阻塞 |  | 1.需要不断轮询，CPU消耗大，适合
2.需要为每一个请求分配一个线程，系统开销大，不适合大并发
3.响应不及时 |
| 多路复用IO模型 | 第一阶段，多个进程的I/O注册到一个复用器（Selector）上面，当没有数据的时候Selector阻塞，当有数据的时候，会返回数据。

第二阶段阻塞 | 1.多个请求可以由一个线程进行管理，节省CPU 和 系统消耗。
2.适合高并发应用，性能好 | 开发难度大 |
| 信号驱动IO模型 | 第一阶段由系统通过注册的信号来通知用户进程，是非阻塞的

第二阶段阻塞 | 应用场景少 |  |
| 异步IO模型 | 第一阶段 第二阶段 都不阻塞，一步完成后通知通知应用程序 | JAVA的aio就是这样 |  |











